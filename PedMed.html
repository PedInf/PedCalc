<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Detailed Pediatric Medications</title>
  <link rel="icon" href="img/TitleLogo.png" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <link rel="stylesheet" href="style/Select.css" />
  <style>
    body {
      background-color: #bcebeb;
    }

    #selectHM {
      font-family: Georgia;
      font-size: clamp(16px, 2vw, 48px);
      width: 30%;
      max-width: 100%;
      box-sizing: border-box;
      height: max-content;
      background-color: #d0ffd0;
      align-self: flex-start;
    }

    .uppercontainer {
      display: flex;
      flex-direction: row;
    }

    select,
    textarea {
      width: 100%;
      margin-bottom: 5px;
      padding: 10px;
    }

    textarea {
      background-color: #e8e8c9;

    }

    .icon-row {
      display: flex;
      justify-content: space-around;
      width: 70%;
      margin-bottom: 0;
    }

    .icon {
      text-align: center;
      cursor: pointer;
    }

    .icon img {
      width: 50px;
      height: 50px;
      border-radius: 50px;
    }

    @media screen and (max-width: 767px) {
      .icon img {
        width: 25px;
        height: 25px;
        border-radius: 25px;
      }
    }

    .icon-label {
      font-weight: bold;
      margin-top: 5px;
    }

    #info-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      border: 2px solid #999;
      border-radius: 10px;
      padding: 20px;
      display: none;
      max-width: 90%;
      z-index: 1000;
    }

    #info-modal .close-button-container {
      text-align: center;
      margin-top: 20px;
    }

    #info-modal .close-button {
      background-color: #007bff;
      color: white;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    #info-title {
      text-align: center;
      font-size: 20px;
      margin-bottom: 15px;
      font-weight: bold;
    }

    #info-modal h3 {
      margin-top: 0;
    }

    #info-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 999;
    }
  </style>
</head>

<body>
  <div id="header-container"></div>
  <header class="page-header">Pediatric Medications Detailed</header>
  <div>
    <div class="uppercontainer">
      <select id="selectHM"></select>

      <div class="icon-row">
        <div class="icon" onclick="showInfo('Pregnancy')">
          <img src="img/preg.webp" alt="Pregnancy" />
          <div class="icon-label" id="PregnancyVal">-</div>
        </div>
        <div class="icon" onclick="showInfo('Breast')">
          <img src="img/bf.png" alt="Breastfeeding" />
          <div class="icon-label" id="BreastVal">-</div>
        </div>
        <div class="icon" onclick="showInfo('Kidney')">
          <img src="img/kidney.webp" alt="Kidney" />
          <div class="icon-label" id="KidneyVal">-</div>
        </div>
        <div class="icon" onclick="showInfo('Liver')">
          <img src="img/liver.webp" alt="Liver" />
          <div class="icon-label" id="LiverVal">-</div>
        </div>
        <div class="icon" onclick="showInfo('Genetic')">
          <img src="img/dna.webp" alt="Genetic" />
          <div class="icon-label" id="GeneticVal">-</div>
        </div>
      </div>
    </div>

    <textarea id="mergedTextarea" readonly placeholder="Combined dose information"></textarea>
  </div>

  <!-- Modal -->
  <div id="info-overlay" onclick="hideInfo()"></div>
  <div id="info-modal">
    <h2 id="info-title"></h2>
    <div id="info-content"></div>
    <div class="close-button-container">
      <button class="close-button" onclick="hideInfo()">Close</button>
    </div>
  </div>

  <script src="/js/header.js"></script>
  <script src="/js/Select.js"></script>
  <script>
    const messages = {
      Pregnancy: `
        <strong>Pregnancy Categories</strong>
        <p>A: No risk in the first trimester; no evidence of risk later.</p>
        <p>B: Animal studies show no risk; no adequate human studies.</p>
        <p>C: Animal studies show adverse effect; no adequate human studies.</p>
        <p>D: Evidence of risk, but benefits may outweigh risks.</p>
        <p>X: Fetal abnormalities found; use is contraindicated.</p>`,

      Breast: `
        <strong>Breastfeeding Categories</strong>
        <p>1: Compatible</p>
        <p>2: Use with caution</p>
        <p>3: Unknown with concerns</p>
        <p>X: Contraindicated</p>
        <p>?: Safety not established</p>`,

      Kidney: `
        Indicates need for caution or dose adjustment in renal impairment.<br>
        See <strong>“Renal Failure Dose”</strong>. If blank, no clear guidance found.`,
      Liver: `
         Indicates need for caution or dose adjustment in hepatic impairment.`,
      Genetic: `
        Indicates need for assessing patient genotype or genetic polymorphism affecting dosing, drug selection, or anticipated pharmacological effects.`,
    };

    function showInfo(category) {
      document.getElementById("info-title").innerText = category;
      document.getElementById("info-content").innerHTML = messages[category];
      document.getElementById("info-modal").style.display = "block";
      document.getElementById("info-overlay").style.display = "block";
    }

    function hideInfo() {
      document.getElementById("info-modal").style.display = "none";
      document.getElementById("info-overlay").style.display = "none";
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadDataAndPopulateSelectAndTextarea(
        "ref/PDC.json",
        "MedicName",
        "Dose",
        "selectHM",
        "mergedTextarea",
        (selectElem) => {
          const mergedTextarea = document.getElementById("mergedTextarea");

          const pregnancy = document.getElementById("PregnancyVal");
          const breast = document.getElementById("BreastVal");
          const kidney = document.getElementById("KidneyVal");
          const liver = document.getElementById("LiverVal");
          const genetic = document.getElementById("GeneticVal");

          const updateExtraFields = () => {
            const selectedIndex = selectElem.selectedIndex;
            const selectedOption = selectElem.options[selectedIndex];
            const selectedText = selectedOption.textContent;

            fetch("ref/PDC.json")
              .then((res) => res.json())
              .then((data) => {
                const med = data.find(
                  (item) => item.MedicName === selectedText
                );
                if (med) {
                  pregnancy.textContent = med.Pregnancy || "-";
                  breast.textContent = med.Breast || "-";
                  kidney.textContent = med.Kidney || "-";
                  liver.textContent = med.Liver || "-";
                  genetic.textContent = med.Genetic || "-";
                  mergedTextarea.value =
                    `${med.Dose || "N/A"}\n\n` +
                    `---------------------------\n` + // separator
                    `⚠️⚠️Renal Failure Dose:\n\n` + // bold markdown style
                    `${med.RenalFailureDose || "No clear guidance found."}`;
                }
              });
          };

          selectElem.addEventListener("change", updateExtraFields);
          updateExtraFields(); // initialize on load
        }
      );
    });
  </script>
</body>

</html>